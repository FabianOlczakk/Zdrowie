#:import Ustawienia ustawienia
#:import Map map
#:import Show phone_numbers
#:import images_path kivymd.images_path
#:import CardTransition kivy.uix.screenmanager.CardTransition
#:import NoTransition kivy.uix.screenmanager.NoTransition
#:import RiseInTransition kivy.uix.screenmanager.RiseInTransition
#:import FadeTransition kivy.uix.screenmanager.FadeTransition
#:import SwapTransition kivy.uix.screenmanager.SwapTransition
#:import WipeTransition kivy.uix.screenmanager.WipeTransition
#:import FallOutTransition kivy.uix.screenmanager.FallOutTransition
#:import SlideTransition kivy.uix.screenmanager.SlideTransition
#:import MDList kivymd.uix.list

<Show>:

<PhoneContent>:

<SecondScreen>:

<CountryOneLineIconListItem>:
    on_release:
        self.parent.down_button(self.text)
        root.parent.parent.parent.parent.current: 'phone_number_list'


<CustomOneLineIconListItem>:
    on_release: self.parent.parent.search_box.set_coordinates(self.text)
    IconLeftWidget:
        icon: root.icon

<CountryDialog>:
    title_color: [0, 0, 0, 1]
    separator_color: app.theme_cls.primary_color
    title_size: 24
    background: "images/white_background.png"
    orientation: "vertical"
    size_hint_y: None
    size_hint: .8, .5
    padding: 20
    spacing: 20
    BoxLayout:
        orientation: "vertical"
        GridLayout:
            cols: 2

            MDLabel:
                text: root.country_name
                font_style: "H4"

            AsyncImage:
                source: root.flag_source

        GridLayout:
            cols: 2
            # spacing: dp(50)
            MDLabel:
                text: u"Liczba zaka\u017ce\u0144" if app.language == "pl" else "Number of cases"
            MDLabel:
                text: root.cases
            MDLabel:
                text: u"Liczba zgon\u00F3w" if app.language == "pl" else "Number of deaths"
            MDLabel:
                text: root.deaths
            MDLabel:
                text: u"Liczba wyzdrowie\u0144" if app.language == "pl" else "Number of recoveries"
            MDLabel:
                text: root.recoveries

<Map>:

<ToolbarWithImage>:

<ItemDrawer>:
    theme_text_color: "Custom"
    on_release: self.parent.set_color_item(self)

    IconLeftWidget:
        id: icon
        icon: root.icon
        theme_text_color: "Custom"
        text_color: root.text_color

<ItemDrawerException>:
    theme_text_color: "Custom"

    IconLeftWidget:
        id: icon
        icon: root.icon
        theme_text_color: "Custom"
        text_color: root.text_color


<ContentNavigationDrawer>:
    orientation: "vertical"
    padding: "8dp"
    spacing: "8dp"
    anchor: anchor

    AnchorLayout:
        id: anchor
        clock: clock
        anchor_x: "center"
        size_hint_y: None
        height: clock.height

        DateTimeClock:
            id: clock
            orientation: "vertical"

            TimeLabel:
                clock: clock
                color: app.theme_cls.primary_dark
                halign: "center"
                font_style: "H4"
                size_hint_y: None
                height: self.texture_size[1]

            DateLabel:
                clock: clock
                color: app.theme_cls.primary_light
                halign: "center"
                font_style: "H6"
                size_hint_y: None
                height: self.texture_size[1]
                text: clock.date

    ScrollView:
        DrawerList:
            id: md_list
            ItemDrawer:
                icon: "home"
                text: u"Wiadomo\u015Bci" if app.language == "pl" else "News"
                text_color: self.theme_cls.primary_color
                on_release:
                    root.secondary_screen_manager.current = "news"
            ItemDrawer:
                icon: "map-legend"
                text: "Mapa COVID-19" if app.language == "pl" else "COVID-19 Map"
                on_release:
                    root.corona_map.start_get_markers_in_fov()
                    root.secondary_screen_manager.current = "map"

            ItemDrawer:
                icon: "contact-phone"
                text: "Numery pomocy" if app.language == "pl" else "Emergency phone numbers"
                on_release:
                    root.secondary_screen_manager.current = "phone_numbers"
            ItemDrawerException:
                icon: "settings"
                text: "Ustawienia" if app.language == "pl" else "Settings"
                on_release: root.main_screen_manager.current = "settings"




Screen:

    ScreenManager:
        id: main_screen_manager
        transition: SlideTransition()

        Screen:
            name: "main_screen"

            ToolbarWithImage:
                pos_hint: {"top": 1}
                image_source: "images/logo_light.png"
                id: toolbar
                anchor_title: "center"
                elevation: 10
                right_action_items: [['', lambda x: print("woohoo")]]
                left_action_items: [['menu', lambda x: nav_drawer.set_state("open")]]

            NavigationLayout:
                x: toolbar.height

                ScreenManager:
                    id: secondary_screen_manager
                    transition: SwapTransition()

                    Screen:
                        name: "news"

                        MDLabel:
                            pos: self.pos
                            text: "Aktualnosci"

                    Screen:
                        size_hint_y: 1.0 - toolbar.height/root.height
                        name: "map"

                        Map:
                            id: corona_map
                            language: app.language
                            country_field: country_field
                            main_screen_manager: main_screen_manager
                            search_box: search_box
                            double_tap_zoom: True
                            zoom: 3
                            on_zoom:
                                self.zoom = 3 if self.zoom < 3 else self.zoom

                            on_lat:
                                self.start_get_markers_in_fov()

                            on_lon:
                                self.start_get_markers_in_fov()

                        MDFloatingActionButtonSpeedDial:
                            data: corona_map.menu_data
                            hint_animation: True
                            icon: "menu-open"
                            callback: corona_map.menu_data_callback
                            md_bg_color: app.theme_cls.primary_color
                            elevation_normal: 10

                    Screen:
                        size_hint_y: 1.0 - toolbar.height/root.height
                        name: "phone_numbers"

                        ScreenManager:
                            id: phone_number_screen_manager
                            Screen:
                                name: 'country_list'
                                ScrollView:
                                    Show:
                                        id: show
                                        phone_number_screen_manager: phone_number_screen_manager
                                        phone_container: phone_container
                                        phone_list_container: phone_list_container
                                        phone_provinces: phone_provinces

                            Screen:
                                name: 'phone_number_list'
                                ScrollView:
                                    MDGridLayout:
                                        id: phone_container
                                        adaptive_height: True
                                        cols: 1
                                        MDList:
                                            id: phone_list_container
                                            OneLineIconListItem:
                                                phone_number_screen_manager: phone_number_screen_manager
                                                phone_container: phone_container
                                                show: show
                                                text: 'Wróć do wyboru kraju'
                                                on_release:
                                                    phone_number_screen_manager.current = 'country_list'
                                                    show.clear_screen()
                                                IconLeftWidget:
                                                    icon: 'arrow-left'


                            Screen:
                                name: 'phone_provinces'
                                ScrollView:
                                    MDGridLayout:
                                        adaptive_height: True
                                        cols: 1
                                        id: phone_provinces
                                        MDList:
                                            id: second_phone_list_container
                                            OneLineIconListItem:
                                                phone_number_screen_manager: phone_number_screen_manager
                                                phone_container: phone_container
                                                show: show
                                                text: 'Wróć do wyboru kraju'
                                                on_release:
                                                    phone_number_screen_manager.current = 'country_list'
                                                    show.clear_provinces()
                                                IconLeftWidget:
                                                    icon: 'arrow-left'



            MDNavigationDrawer:
                id: nav_drawer

                ContentNavigationDrawer:
                    id: content_drawer
                    main_screen_manager: main_screen_manager
                    secondary_screen_manager: secondary_screen_manager
                    corona_map: corona_map


        Screen:
            name: "settings"

            MDToolbar:
                type: "top"
                id: settings_toolbar
                ustawienia: ustawienia
                pos_hint: {"top": 1}
                title: "Ustawienia" if app.language == "pl" else "Settings"
                anchor_title: "center"
                bold: False
                elevation: 10
                right_action_items: [["", lambda x: x]]
                left_action_items:
                    [['arrow-left', lambda x: ustawienia.back_to_home_screen()]]

            Screen:
                size_hint_y: 1.0 - settings_toolbar.height/root.height

                ScrollView:
                    do_scroll_x: False
                    do_scroll_y: True

                    BoxLayout:
                        id: list
                        size_hint: 1, None
                        height: self.minimum_height
                        orientation: "vertical"

                        TwoLineIconListItem:
                            text: "Kolor aplikacji" if app.language == "pl" else "App color"
                            secondary_text: "Zmie\u0144 kolor aplikacji" if app.language == "pl" else "Change the app color"
                            on_release:
                                ustawienia.open_theme_picker()

                            IconLeftWidget:
                                icon: "format-color-fill"

                        TwoLineIconListItem:
                            text: u"J\u0119zyk" if app.language == "pl" else "Language"
                            secondary_text: "Zmie\u0144 j\u0119zyk aplikacji" if app.language == "pl" else "Change the display language"
                            on_release:
                                ustawienia.open_language_selector()

                            IconLeftWidget:
                                icon: "earth"
        Screen:
            name: "search_dialog"

            MDToolbar:
                type: "top"
                id: search_toolbar
                ustawienia: ustawienia
                pos_hint: {"top": 1}
                title: "Wyszukaj kraj" if app.language == "pl" else "Search"
                anchor_title: "center"
                bold: False
                elevation: 10
                right_action_items: [["", lambda x: x]]
                left_action_items:
                    [['arrow-left', lambda x: ustawienia.back_to_home_screen()]]

            SearchBox:
                size_hint_y: 1.0 - search_toolbar.height/root.height
                id: search_box
                rv: rv
                country_field: country_field
                corona_map: corona_map
                ustawienia: ustawienia

                BoxLayout:

                    rv: rv
                    country_field: country_field
                    corona_map: corona_map
                    orientation: "vertical"
                    padding: "20dp"
                    spacing: "10dp"

                    BoxLayout:
                        size_hint_y: None
                        height: self.minimum_height

                        MDTextField:
                            id: country_field
                            search_box: search_box
                            hint_text: "Kraj" if app.language == "pl" else "Contry name"
                            helper_text: u"Wpisz nazw\u0119 kraju"  if app.language == "pl" else "Type the country name"
                            helper_text_mode: "on_focus"
                            on_text: search_box.set_country_filter(self.text, True)


                    RecycleView:
                        id: rv
                        search_box: search_box
                        key_viewclass: 'viewclass'
                        key_size: 'height'

                        RecycleBoxLayout:
                            padding: dp(10)
                            default_size: None, dp(48)
                            default_size_hint: 1, None
                            size_hint_y: None
                            height: self.minimum_height
                            orientation: 'vertical'




        Screen:
            name: "language_settings"

            MDToolbar:
                type: "top"
                id: language_toolbar
                ustawienia: ustawienia
                pos_hint: {"top": 1}
                title: u"J\u0119zyk" if app.language == "pl" else "Language"
                anchor_title: "center"
                bold: False
                elevation: 10
                right_action_items: [["", lambda x: x]]
                left_action_items:
                    [['arrow-left', lambda x: ustawienia.back_to_settings()]]

            Screen:
                size_hint_y: 1.0 - language_toolbar.height/root.height

                ScrollView:
                    do_scroll_x: False
                    do_scroll_y: True
                    Ustawienia:
                        orientation: "vertical"
                        main_screen_manager: main_screen_manager
                        secondary_screen_manager: secondary_screen_manager
                        nav_drawer: nav_drawer
                        content_drawer: content_drawer
                        id: ustawienia
                        size_hint: 1, None
                        height: self.minimum_height
                        TwoLineIconListItem:
                            text: u"Polski"
                            secondary_text: "Zmie\u0144 j\u0119zyk aplikacji na Polski"

                            on_press:
                                app.set_language_to_pl()

                            IconLeftWidget:
                                icon: "earth"

                        TwoLineIconListItem:
                            text: u"English"
                            secondary_text: "Sets the app language to english"

                            on_press:
                                app.set_language_to_en()

                            IconLeftWidget:
                                icon: "earth"